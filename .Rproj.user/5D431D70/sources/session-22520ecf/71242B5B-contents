---
title: "æå®šåšå®¢çš„è‡ªåŠ¨å‘å¸ƒ"
subtitle: "ä¹‹å‰çš„æ‰‹åŠ¨shell scriptå‘å¸ƒè¦ç»ˆç»“äº†"
description: "è‡ªå·±çªç ´ä¸€ä¸‹"
author: "adp"
date: 2024-12-07 16:46:55
date-modified: 2024-12-07 19:33:59
categories: [github, deploy, action]
keywords: [Github, Deploy, Action]
tags: [Github, Deploy, Action]
freeze: true
format:
  html: 
    embed-resources: true
execute:
  trusted: true
---

æ‰‹åŠ¨å‘å¸ƒå°è¾›è‹¦äº†ï¼Œä»Šå¤©å°±åœ¨AIçš„åŠ æŒä¸‹ï¼Œè¿ˆå‘è‡ªåŠ¨å‘å¸ƒå§ã€‚

é—®: æˆ‘å·²ç»é…ç½®å·æœåŠ¡å™¨ï¼Œåªè¦å‘å¸ƒå†…å®¹æ”¾å…¥æœåŠ¡å™¨wwwæ–‡ä»¶å¤¹å³å¯æ­£å¸¸æµè§ˆã€‚æˆ‘
ä¹Ÿé…ç½®å·äº†quartoï¼Œæ¯æ¬¡æ¸²æŸ“å¥½çš„å‘å¸ƒå†…å®¹éƒ½æ”¾åœ¨æœ¬åœ°é¡¹ç›®æ–‡ä»¶å¤¹publishä¸­ã€‚æˆ‘
å·²æœ‰GitHubè´¦å·ã€‚ç°
åœ¨è¯·æŒ‡å¯¼æˆ‘å°†publishåŒæ­¥åˆ°githubä¸­ï¼Œç„¶åè®©githubè‡ªåŠ¨ç®¡ç†å’ŒåŒæ­¥å†…å®¹åˆ°æˆ‘çš„æœåŠ¡å™¨å‘å¸ƒç›®å½•wwwã€‚å¦‚
æœéœ€è¦æˆ‘æä¾›ç›¸å…³çš„ä¿¡æ¯å’Œè®¾ç½®ï¼Œè¯·è¯¦ç»†è¯´æ˜ã€‚

::: callout-tip
## æé—®çš„æŠ€å·§

ä½ åšäº†ä»€ä¹ˆï¼Œéœ€è¦aiç»™ä½ ä»€ä¹ˆï¼Ÿè¾“
å…¥ï¼Œè¾“å‡ºï¼Œç®—æ³•ï¼ˆåŸºæœ¬æ­¥éª¤ï¼‰ï¼Œè¿™æ ·aiå¯ä»¥ç»™ä½ æ›´å¥½çš„å›ç­”ã€‚æ‰€
ä»¥ä½ çŸ¥é“çš„è¶Šå¤šï¼Œaiè¶Šèƒ½å¸®åŠ©ä½ ï¼ŒæŠŠéœ€è¦çš„æ¦‚å¿µåŠ ä»¥å‘½åï¼Œaiå°±æ›´å¥½ç¬¬å¼•ç”¨å›å¤äº†ã€‚
:::

AIå›ç­”: å¥½çš„ï¼ä»¥
ä¸‹æ˜¯å¦‚ä½•å°† Quarto æ¸²æŸ“ç”Ÿæˆçš„ publish æ–‡ä»¶å¤¹å†…å®¹è‡ªåŠ¨åŒæ­¥åˆ° GitHubï¼Œå¹¶é€šè¿‡ GitHub å°†å†…å®¹éƒ¨ç½²åˆ°æœåŠ¡å™¨çš„å®Œæ•´æ­¥éª¤ã€‚æˆ‘
ä»¬å°†é€æ­¥æŒ‡å¯¼æ‚¨å®Œæˆä» Git åˆ°æœåŠ¡å™¨çš„è‡ªåŠ¨åŒ–æµç¨‹ã€‚

ä»¥ä¸‹æ˜¯å®ç°ç›®æ ‡çš„å®Œæ•´æµç¨‹ï¼š

1.  **åˆ›å»º GitHub ä»“åº“å¹¶ä¸Šä¼  `publish` æ–‡ä»¶å¤¹çš„å†…å®¹**ã€‚

2.  **æœ¬åœ°åˆå§‹åŒ– Git ä»“åº“å¹¶æ¨é€åˆ° GitHub**ã€‚

3.  **åœ¨æœåŠ¡å™¨ä¸Šè®¾ç½® SSH ç§é’¥/å…¬é’¥ï¼Œå…è®¸ GitHub è®¿é—®æœåŠ¡å™¨ã€‚**

4.  **é…ç½® GitHub Actions è‡ªåŠ¨åŒæ­¥å†…å®¹åˆ°æœåŠ¡å™¨çš„ `www` ç›®å½•**ã€‚

å¦‚æœéœ€è¦ä»»ä½•å…·ä½“ä¿¡æ¯ï¼ˆå¦‚æœåŠ¡å™¨ SSH é…ç½®ç­‰ï¼‰ï¼Œè¯·æ ¹æ®æç¤ºæä¾›ç›¸å…³ä¿¡æ¯ã€‚

------------------------------------------------------------------------

### **Step 1: åˆ›å»º GitHub ä»“åº“**

 1.
ç™»é™† [GitHub](https://github.com/)ï¼Œåœ¨å³ä¸Šè§’ç‚¹å‡» **"+"**ï¼Œé€‰æ‹© **â€œNew repositoryâ€**ã€‚

2.  åˆ›å»ºä¸€ä¸ªæ–°çš„ä»“åº“ï¼š

    -   **Repository name**: è¾“å…¥ä»“åº“åç§°ï¼ˆä¾‹å¦‚ `my-quarto-site`ï¼‰ã€‚

    -   ç¡®ä¿ä»“åº“çš„ **Visibility** é€‰æ‹©ä¸º Public æˆ– Privateï¼ˆæ ¹æ®éœ€æ±‚ï¼‰ã€‚

    -   ä¸è¦åˆå§‹åŒ– `README` æ–‡ä»¶æˆ–æ·»åŠ  `.gitignore` æ–‡ä»¶ã€‚

3.  åˆ›å»ºæˆåŠŸåï¼Œè®°ä¸‹ä»“åº“çš„ Clone åœ°å€ï¼ˆé€šå¸¸æ˜¯ `https://github.com/yourusername/my-quarto-site.git` æˆ–ç”¨ SSH æ ¼å¼ï¼‰ã€‚

    ç»“æœ: é¡ºåˆ©å®Œæˆ **git\@github.com:ming-git/adp.git**

------------------------------------------------------------------------

### **Step 2: åˆå§‹åŒ–æœ¬åœ° Git ä»“åº“å¹¶æ¨é€åˆ° GitHub**

ç°åœ¨éœ€è¦å°†æ‚¨çš„ Quarto é¡¹ç›®çš„ `publish` æ–‡ä»¶å¤¹åŒæ­¥åˆ° GitHub ä»“åº“ã€‚

1.  æ‰“å¼€æ‚¨çš„ç»ˆç«¯æˆ– RStudio çš„ç»ˆç«¯é¢æ¿ï¼Œå¹¶è¿›å…¥ Quarto é¡¹ç›®ç›®å½•ï¼š

    ```         
    cd /path/to/your/project
    ```

2.  è¿›å…¥æ¸²æŸ“ç”Ÿæˆçš„ `publish` æ–‡ä»¶å¤¹ï¼š

    ```         
    cd publish
    ```

3.  åˆå§‹åŒ–ä¸€ä¸ª Git ä»“åº“ï¼š

    ```         
    git init
    ```

4.  æ·»åŠ æ‰€æœ‰å†…å®¹åˆ° Git ä»“åº“å¹¶æäº¤ï¼š

    ```         
    git add .
    git commit -m "Initial commit of Quarto publish content"
    ```

5.  æ·»åŠ è¿œç¨‹ä»“åº“åœ°å€ï¼š **ä½¿ç”¨ HTTPS**ï¼š

    ```         
    git remote add origin https://github.com/yourusername/my-quarto-site.git
    ```

    **æˆ–è€…ä½¿ç”¨ SSHï¼ˆå¦‚é…ç½®äº† SSH å¯†é’¥ï¼‰ï¼š**2024-12-07 17:25:55 ä½¿ç”¨è¯¥æ–¹å¼

    ```         
    git remote add origin git@github.com:yourusername/my-quarto-site.git
    ```

6.  æ¨é€åˆ° GitHub ä»“åº“çš„ `main` åˆ†æ”¯ï¼š

    ```         
    git branch -M main
    git push -u origin main
    ```

æ­¤æ—¶ï¼Œæ‚¨çš„ `publish` æ–‡ä»¶å¤¹ä¸­çš„æ‰€æœ‰å†…å®¹åº”è¯¥å·²ç»æˆåŠŸæ¨é€åˆ° GitHub ä»“åº“ã€‚

2024-12-07 17:29:23 check ok

------------------------------------------------------------------------

### **Step 3: è®¾ç½®æœåŠ¡å™¨çš„ SSH é…ç½®**

ä¸ºäº†è®© GitHub å¯ä»¥è‡ªåŠ¨å°†å†…å®¹åŒæ­¥åˆ°æ‚¨çš„æœåŠ¡å™¨ï¼Œéœ€è¦è®¾ç½® GitHub çš„è®¿é—®æƒé™ï¼Œé€šè¿‡ **SSH å¯†é’¥** å°† GitHub å’ŒæœåŠ¡å™¨è¿æ¥ã€‚

#### **1. é…ç½®æœåŠ¡å™¨ä¸Šçš„ SSH å¯†é’¥ï¼š**

1.  ç™»é™†æœåŠ¡å™¨ï¼ˆé€šè¿‡ SSH ç™»å½•ï¼‰ã€‚åœ¨
    æœåŠ¡å™¨ç»ˆç«¯æ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼Œæ£€æŸ¥æ˜¯å¦å·²å­˜åœ¨ SSH å¯†é’¥ï¼š

    ```         
    ls ~/.ssh/id_rsa
    ```

2.  å¦‚æœä¸å­˜åœ¨ï¼Œåˆ›å»ºä¸€ä¸ªæ–°çš„å•ç‹¬çš„ SSH å¯†é’¥å¯¹ï¼š

    ```         
    ssh-keygen -t rsa -b 4096 -C "zhuquanming@gmail.com" -f ~/.ssh/id_rsa_github
    ```

    ![](images/ssh-keygen.png)

    æŒ‰è¦æ±‚è¾“å…¥è·¯å¾„ï¼ˆæˆ–æŒ‰ ENTER ç›´æ¥ä½¿ç”¨é»˜è®¤è·¯å¾„ï¼‰ï¼Œè®¾ç½®å¯†ç å¯é€‰ã€‚

3.  å°†ç”Ÿæˆçš„å…¬é’¥å¤åˆ¶åˆ°å‰ªè´´æ¿ï¼š

    ```         
    cat ~/.ssh/id_rsa_github.pub
    ```

    å¤åˆ¶ç»ˆç«¯è¾“å‡ºçš„å†…å®¹ã€‚

#### **2. æ·»åŠ å…¬é’¥åˆ° GitHubï¼š**

1.  ç™»é™† GitHubï¼Œç‚¹å‡»å³ä¸Šè§’å¤´åƒï¼Œè¿›å…¥ **Settings(è´¦å·settings)**ã€‚

2.  æ‰¾åˆ°å·¦ä¾§çš„ **SSH and GPG keys**ï¼Œç‚¹å‡» **New SSH key**ã€‚

3.  æ·»åŠ  `.ssh/id_rsa_github.pub` çš„å†…å®¹åˆ° GitHubï¼Œå¹¶ç‚¹å‡»ä¿å­˜ã€‚

4.  ä¿®æ”¹æœåŠ¡å™¨ssh config file

    ç¼–è¾‘æˆ–åˆ›å»º SSH é…ç½®æ–‡ä»¶ï¼Œå‘Šè¯‰ SSH ä½¿ç”¨æ­£ç¡®çš„å¯†é’¥æ–‡ä»¶ã€‚

    1.  æ‰“å¼€æˆ–åˆ›å»ºæ–‡ä»¶Â `~/.ssh/config`ï¼š

        ```         
        vi ~/.ssh/config
        ```

    2.  æ·»åŠ ä»¥ä¸‹å†…å®¹ï¼ˆå°†Â `~/.ssh/id_rsa`Â æ›¿æ¢ä¸ºä½ æ·»åŠ åˆ° GitHub çš„å¯†é’¥è·¯å¾„ï¼Œä¾‹å¦‚Â `~/.ssh/id_rsa_github`ï¼‰ï¼š

        ```         
        Host github.com
            HostName github.com
            User git
            IdentityFile ~/.ssh/id_rsa_github
            IdentitiesOnly yes
        ```

    3.  ä¿å­˜é€€å‡º (ï¼šwq)ã€‚

#### **3. æµ‹è¯• SSH è¿æ¥ï¼š**

å›åˆ°æœåŠ¡å™¨ï¼Œæµ‹è¯• GitHub æ˜¯å¦å¯ä»¥è®¿é—®ï¼š

```         
ssh -T git@github.com
```

å¦‚æœæ˜¾ç¤ºå¦‚ä¸‹å†…å®¹ï¼Œè¡¨ç¤ºè¿æ¥æˆåŠŸï¼š

```         
Hi yourusername! You've successfully authenticated, but GitHub does not provide shell access.
```

------------------------------------------------------------------------

### **Step 4: é…ç½® GitHub Actions è‡ªåŠ¨åŒ–éƒ¨ç½²**

GitHub Actions æ˜¯ GitHub å†…ç½®çš„ä¸€ç§å·¥å…·ï¼Œç”¨æ¥è‡ªåŠ¨åŒ–å·¥ä½œæµã€‚åœ¨
æˆ‘ä»¬é…ç½®åï¼ŒGitHub ä¼šåœ¨æ¯æ¬¡æ‚¨æ¨é€å†…å®¹åˆ° `main` åˆ†æ”¯æ—¶ï¼Œè‡ªåŠ¨å°† `publish` æ–‡ä»¶å¤¹çš„å†…å®¹åŒæ­¥åˆ°æœåŠ¡å™¨çš„ `www` ç›®å½•ã€‚

#### **1. åœ¨ GitHub ä»“åº“ä¸­åˆ›å»º Actions é…ç½®æ–‡ä»¶ï¼š**

1.  åœ¨é¡¹ç›®ä¸­åˆ›å»ºä¸€ä¸ª `.github/workflows` æ–‡ä»¶å¤¹ï¼ˆå¦‚æœä¸å­˜åœ¨ï¼‰ã€‚

    ::: callout-caution
    ## ä¸æ˜¯åœ¨æ¸²æŸ“è¾“å‡ºç›®å½•ä¸‹å–”

    çŠ¯äº†ä¸€ä¸ªé”™è¯¯ï¼Œå»ºç«‹åœ¨äº†æ¸²æŸ“è¾“å‡ºç›®å½•ä¸‹ï¼Œç»“æœç›´æ¥è¢«åˆ é™¤äº†å“ˆ, å¯¹äºgitè¿˜æ˜¯æœ‰ç‚¹é™Œç”Ÿï¼Œå¥½ä¹…ä¸ç”¨ï¼Œä¹‹å‰å­¦ä¹ çš„mosh gitæ•™ç¨‹åˆå®Œå…¨å¿˜è®°äº†ã€‚
    :::

2.  åœ¨æ–‡ä»¶å¤¹ä¸‹æ–°å»ºæ–‡ä»¶ `deploy2tclh.yml`ï¼Œå¹¶é…ç½®ä»¥ä¸‹å†…å®¹ï¼š

```         
name: Deploy to Tencent Lighthouse Server

on:
  push:
    branches:
      - main  # å½“æ¨é€åˆ° main åˆ†æ”¯æ—¶è§¦å‘

jobs:
  deploy:
    runs-on: ubuntu-latest

    steps:
    # 1. æ£€å‡ºæœ€æ–°ä»£ç 
    - name: Checkout code
      uses: actions/checkout@v3

    # 2. ä½¿ç”¨ rsync å°†å†…å®¹ä¸Šä¼ åˆ°æœåŠ¡å™¨
    - name: Sync to server
      run: |
        rsync -avz --delete ./ user@your-server-ip:/path/to/your/www/
      env:
        RSYNC_RSH: "ssh -i ~/.ssh/id_rsa"
```

#### **2. é…ç½®æœåŠ¡å™¨è®¿é—®çš„ç§é’¥ï¼š**

ä¸ºäº†è®© GitHub Actions åœ¨æœåŠ¡å™¨ä¸Šä½¿ç”¨ SSHï¼Œè¿˜éœ€å°†æœåŠ¡å™¨çš„ **ç§é’¥** æ·»åŠ åˆ° GitHub ä»“åº“çš„ Secretsã€‚

1.  ç™»å½• GitHub ä»“åº“ï¼Œè¿›å…¥ **Settings \> Secrets and variables \> Actions**ã€‚

    ::: {.callout-tip appearance="simple"}
    ## è´¦å·Settingå’Œé¡¹ç›®Settingè¦åŒºåˆ†

    æ³¨æ„ï¼šæ˜¯åœ¨[https://github.com/ming-git/adpblog/settings](https://github.com/ming-git/adp/settings) é¡¹ç›®çš„settingä¸­ä¿®æ”¹ï¼›è€Œä¸æ˜¯ä¸ªäººè´¦æˆ·çš„setting ï¼ˆ<https://github.com/settings/profile>ï¼‰ä¸­ã€‚æµª
    è´¹äº†ç‚¹æ—¶é—´ã€‚
    :::

2.  ç‚¹å‡» **New repository secret**ï¼Œå‘½åä¸º `SSH_PRIVATE_KEY`ï¼Œå¹¶å°†æœåŠ¡å™¨ç§é’¥ï¼ˆ`~/.ssh/id_rsa_github` çš„å†…å®¹ï¼‰ç²˜è´´è¿›å»ã€‚

    ::: callout-tip
    ## å°†é”™å°±é”™å§

    æœ¬æ¥æ˜¯tclhï¼Œéº»çƒ¦äº†å°±ä¸æ”¹å†™äº†å“ˆ

    2024-12-08 07:55:15 æ¢å¤åˆ°åŸå§‹çš„å‘½å
    :::

#### **3. ä¿®æ”¹ `deploy2tclh.yml` å¼•ç”¨ Secrets ä¸­çš„ç§é’¥ï¼š**

æ›´æ–° `deploy2tclh.yml` æ–‡ä»¶ï¼š

```         
- name: Sync to server
  run: |
    mkdir -p ~/.ssh/ 
    echo "$SSH_PRIVATE_KEY" > ~/.ssh/id_rsa_github
    chmod 600 ~/.ssh/id_rsa_github
    rsync -avz --delete ./ user@your-server-ip:/path/to/your/www/
  env:
    SSH_PRIVATE_KEY: ${{ secrets.SSH_TLCH_PRIVATE_KEY }}
```

------------------------------------------------------------------------

### **Step 5: æµ‹è¯•å·¥ä½œæµ**

1.  å›åˆ°æœ¬åœ°ç»ˆç«¯ï¼Œä¿®æ”¹æ‚¨çš„ `publish` æ–‡ä»¶å¤¹çš„å†…å®¹ï¼ˆæ¯”å¦‚æ–°å»ºä¸€ä¸ªæ–‡ä»¶æˆ–ä¿®æ”¹ç°æœ‰å†…å®¹ï¼‰ã€‚

2.  æäº¤æ–°çš„å†…å®¹åˆ° GitHub ä»“åº“ï¼š

    ```         
    git add .
    git commit -m "Update content"
    git push origin main
    ```

3.  åˆ° GitHub ä»“åº“çš„ **Actions** é¡µé¢ï¼Œæ‚¨åº”è¯¥å¯ä»¥çœ‹åˆ° `Deploy to Server` å·¥ä½œæµè¢«è§¦å‘ã€‚

4.  å¦‚æœé…ç½®æ­£ç¡®ï¼Œå†…å®¹å°†è‡ªåŠ¨åŒæ­¥åˆ°æ‚¨æœåŠ¡å™¨çš„ `www` ç›®å½•ã€‚

------------------------------------------------------------------------

### **é—®é¢˜æ’æŸ¥**

1.  å¦‚æœåŒæ­¥å¤±è´¥ï¼Œè¯·æ£€æŸ¥æœåŠ¡å™¨ `www` ç›®å½•çš„è·¯å¾„æ˜¯å¦æ­£ç¡®ã€‚

2.  æµ‹è¯• `rsync` æ˜¯å¦èƒ½å¤Ÿåœ¨æœåŠ¡å™¨å’Œ GitHub Actions å·¥ä½œæµä¸­æ­£å¸¸å·¥ä½œã€‚

3.  ç¡®è®¤ SSH è®¾ç½®æ˜¯å¦æ­£ç¡®ï¼Œ`id_rsa` å¯ä»¥æ­£å¸¸æˆæƒè®¿é—®æœåŠ¡å™¨ã€‚

------------------------------------------------------------------------

### **æ€»ç»“**

é€šè¿‡ä¸Šè¿°æ­¥éª¤ï¼Œæ‚¨å¯ä»¥å®ç°ï¼š

1.  æœ¬åœ° Quarto æ¸²æŸ“ç”Ÿæˆå†…å®¹åˆ° `publish` æ–‡ä»¶å¤¹ã€‚

2.  ä½¿ç”¨ Git å°† `publish` æ–‡ä»¶å¤¹å†…å®¹ä¸Šä¼ åˆ° GitHubã€‚

3.  é…ç½® GitHub Actionsï¼Œè®© `publish` çš„å†…å®¹è‡ªåŠ¨éƒ¨ç½²åˆ°æœåŠ¡å™¨çš„ `www` ç›®å½•ï¼Œå®Œæˆå‘å¸ƒçš„è‡ªåŠ¨åŒ–ã€‚

å¦‚æœè¿˜æœ‰ä»»ä½•é—®é¢˜ï¼Œè¯·éšæ—¶å‘Šè¯‰æˆ‘ï¼
ğŸ˜Š
